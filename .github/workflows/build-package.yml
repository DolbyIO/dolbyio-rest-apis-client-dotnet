name: Build NuGet Package

on:
  push:

env:
  VERSION: "1.0.0"

jobs:
  build-nuget-package:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout 🛎️
      uses: actions/checkout@v3
      with:
        persist-credentials: false
    - uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.x'
    - name: Set version
      if: github.event_name == 'push' && startsWith(github.ref, 'refs/tags')
      run: echo "::set-env name=VERSION::$(($env:GITHUB_REF -split '/')[-1] -replace ' ','')"
    - name: Build the solution 🔨
      run: dotnet build -p:Version=$VERSION
    - name: Run Unit Tests 🍴
      run: dotnet test
    - name: Create NuGet package 🌎
      run: dotnet pack DolbyIO.Rest/DolbyIO.Rest.csproj -p:Version=$VERSION
